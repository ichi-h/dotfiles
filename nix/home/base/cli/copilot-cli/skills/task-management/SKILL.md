---
name: task-management
description: 課題解決のためのタスク管理方法を定義します。タスクファイルの構造、フォーマット、命名規則、依存関係、品質保証タスクのガイドラインを提供します。
---

# タスク管理スキル

## タスクファイルの構造

### ファイルの場所

タスクファイルは以下の形式で保存されます：

```
.{username}/{year}-{month}-{day}-{issue-name}.md
```

**例**:

- `.ichi-h/2026-02-12-user-authentication.md`
- `.ichi-h/2026-03-15-fix-memory-leak.md`

**命名規則**:

- `{username}`: ユーザー名（例: ichi-h）
- `{year}-{month}-{day}`: 課題作成日（YYYY-MM-DD形式）
- `{issue-name}`: 課題名（kebab-case）

### ファイルフォーマット

```markdown
# {issue-name}

## 概要

この課題が達成しようとしていることの簡潔な説明（2-3文）

## タスク

- [ ] task-{id}: タスクの説明
- [ ] task-{id}: タスクの説明 (dependent on: {task-id1})
- [ ] task-{id}: タスクの説明 (dependent on: {task-id1}, {task-id2})
```

## タスクID

### フォーマット

- 形式: `task-{random-4-char}`
- 小文字の英字と数字のみ使用
- 同じissue内で一意である必要がある
- **例**: `task-a7f3`, `task-x9k2`, `task-m4p1`, `task-b2c8`

### 生成方法

ランダムな4文字の文字列を生成します。英数字（小文字）のみ。

## タスクの説明

### フォーマット

```markdown
- [ ] task-{id}: {動詞} {対象} [{追加コンテキスト}]
```

### 例

- `- [ ] task-a1b2: 認証システムのアーキテクチャを設計する`
- `- [ ] task-c3d4: JWTトークンの生成と検証を実装する`
- `- [ ] task-e5f6: 認証エンドポイントのユニットテストを追加する`

### ベストプラクティス

- **動作動詞を使用**: 実装、設計、修正、追加、レビュー、テスト
- **具体的に**: 何をするかを明確に
- **必要に応じてコンテキストを含める**
- **簡潔かつ明確に**

## 依存関係の指定

### フォーマット

```markdown
(dependent on: task-id1, task-id2, ...)
```

### ルール

- 直接的な依存関係のみをリストする
- 依存関係のないタスクには注釈なし
- 依存関係は同じファイル内に存在するタスクIDである必要がある
- すべての依存タスクが完了するまで実行できない

### 並列実行

依存関係のないタスク、または依存関係がすべて完了したタスクは並列実行できます。

**例**:

```markdown
- [x] task-a1b2: システム設計
- [ ] task-c3d4: フロントエンド実装 (dependent on: a1b2)
- [ ] task-e5f6: バックエンド実装 (dependent on: a1b2)
- [ ] task-g7h8: 統合テスト (dependent on: c3d4, e5f6)
```

実行順序:

1. `task-a1b2` を実行
2. `task-a1b2` 完了後、`task-c3d4` と `task-e5f6` を**並列実行**
3. 両方完了後、`task-g7h8` を実行

## タスクの粒度

### 適切な粒度

- **1タスク = 15分〜2時間の作業**
- 各タスクは1つのエージェントで完了可能
- 明確な入力と出力がある
- 独立して検証可能

### 避けるべきこと

- **大きすぎるタスク** (> 2時間): より小さい単位に分割
- **小さすぎるタスク** (< 15分): 関連するマイクロタスクをまとめる
- **曖昧なタスク**: 具体的な行動が不明確

## 品質保証タスク

### 必須のQAタスク

すべての実装には以下を含める必要があります:

1. **コードレビュー**: 実装後
2. **セキュリティレビュー**: セキュリティに関わる機能の場合は必須
3. **テスト**: ユニットテスト、統合テストなど

### QAタスクの配置

- 実装タスクの後に配置
- 適切な依存関係を設定
- 並列実行可能な場合は並列に（例: コードレビューとセキュリティレビュー）

**例**:

```markdown
- [x] task-a1b2: 認証機能を実装
- [x] task-c3d4: テストを追加 (dependent on: a1b2)
- [ ] task-e5f6: コードレビュー (dependent on: c3d4)
- [ ] task-g7h8: セキュリティレビュー (dependent on: c3d4)
```

`task-e5f6` と `task-g7h8` は並列実行可能。

## タスクファイルの操作

### 新規作成

1. 適切な命名規則でファイルパスを決定
2. `create` ツールを使用してファイルを作成
3. 上記のフォーマットに従ってコンテンツを記述

### 既存ファイルの更新

1. `view` ツールで現在の内容を読み込む
2. **完了済みタスク (`[x]`) は保持する**
3. 新しいタスクを追加（新しいタスクIDで）
4. 必要に応じて依存関係を更新
5. `edit` ツールでファイルを更新

### タスクの完了マーク

タスクが正常に完了したら:

```markdown
変更前: - [ ] task-a7f3: 認証を実装
変更後: - [x] task-a7f3: 認証を実装
```

`edit` ツールを使用して `- [ ]` を `- [x]` に変更します。

## タスクファイルの例

### 例1: 機能実装

```markdown
# user-authentication-system

## 概要

サインアップ、ログイン、パスワードハッシュ化、セッション管理を含む、安全なJWTベースの認証システムを実装します。

## タスク

- [ ] task-a1b2: JWT認証のアーキテクチャとデータモデルを設計
- [ ] task-c3d4: 認証設計のセキュリティレビュー (dependent on: a1b2)
- [ ] task-e5f6: ユーザーモデルとデータベースマイグレーションを実装 (dependent on: c3d4)
- [ ] task-g7h8: JWT生成と検証ユーティリティを実装 (dependent on: c3d4)
- [ ] task-i9j0: ログインAPIエンドポイントを実装 (dependent on: g7h8)
- [ ] task-k1l2: サインアップAPIエンドポイントを実装 (dependent on: e5f6)
- [ ] task-m3n4: 保護されたルート用の認証ミドルウェアを追加 (dependent on: g7h8)
- [ ] task-o5p6: 認証フロー用のユニットテストと統合テストを追加 (dependent on: i9j0, k1l2, m3n4)
- [ ] task-q7r8: 認証実装のコードレビュー (dependent on: o5p6)
- [ ] task-s9t0: 認証実装のセキュリティレビュー (dependent on: o5p6)
```

### 例2: バグ修正

```markdown
# fix-memory-leak-data-processing

## 概要

データ処理モジュールのメモリリークを調査・修正し、将来のリークを防ぐためのモニタリングを追加します。

## タスク

- [ ] task-a1b2: データ処理モジュールのメモリリーク原因を調査
- [ ] task-c3d4: 特定されたメモリリークを修正 (dependent on: a1b2)
- [ ] task-e5f6: メモリ使用量のモニタリングとアラートを追加 (dependent on: c3d4)
- [ ] task-g7h8: メモリが適切に解放されることを検証する回帰テストを追加 (dependent on: c3d4)
- [ ] task-i9j0: メモリリーク修正のコードレビュー (dependent on: e5f6, g7h8)
```

### 例3: 更新されたタスクファイル（セキュリティ問題発見後）

```markdown
# user-authentication-system

## 概要

サインアップ、ログイン、パスワードハッシュ化、セッション管理を含む、安全なJWTベースの認証システムを実装します。

## タスク

- [x] task-a1b2: JWT認証のアーキテクチャとデータモデルを設計
- [x] task-c3d4: 認証設計のセキュリティレビュー (dependent on: a1b2)
- [x] task-e5f6: ユーザーモデルとデータベースマイグレーションを実装 (dependent on: c3d4)
- [x] task-g7h8: JWT生成と検証ユーティリティを実装 (dependent on: c3d4)
- [x] task-i9j0: ログインAPIエンドポイントを実装 (dependent on: g7h8)
- [x] task-k1l2: サインアップAPIエンドポイントを実装 (dependent on: e5f6)
- [x] task-m3n4: 保護されたルート用の認証ミドルウェアを追加 (dependent on: g7h8)
- [x] task-o5p6: 認証フロー用のユニットテストと統合テストを追加 (dependent on: i9j0, k1l2, m3n4)
- [x] task-q7r8: 認証実装のコードレビュー (dependent on: o5p6)
- [x] task-s9t0: 認証実装のセキュリティレビュー (dependent on: o5p6) - 脆弱性発見
- [ ] task-u1v2: パスワードハッシュのソルト生成の脆弱性を修正
- [ ] task-w3x4: 適切なソルト生成を検証するテストを更新 (dependent on: u1v2)
- [ ] task-y5z6: セキュリティレビューを再実行 (dependent on: u1v2, w3x4)
```

**注意**:

- 完了したタスクは `[x]` で保持
- 新しいタスクには新しいIDを使用
- 依存関係を適切に更新

## 重要な注意事項

1. **タスクファイルが真実の源**: 常にタスクファイルを読んで更新する
2. **完了タスクは保持**: 更新時に `[x]` マーカーを保持
3. **一意のタスクID**: 同じissue内で重複しないようにする
4. **依存関係を最小化**: 不必要な順次実行を避け、並列性を最大化
5. **品質計画**: 常にレビューとテストのタスクを含める
6. **セキュリティ優先**: セキュリティに関わる機能には必須のセキュリティチェック
7. **並列実行の最適化**: 同時実行可能なタスクを特定して有効化
8. **シンプルに保つ**: orchestratorが解析・実行しやすい形式
